(window.webpackJsonp=window.webpackJsonp||[]).push([["admin.role"],{"715f":function(e,t,n){"use strict";n.r(t);var i=n("8ade"),o=[{name:"id",label:"编号",show:!1,width:240},{name:"name",label:"名称",width:150},{name:"remarks",label:"备注"},{name:"creator",label:"创建人",width:100,show:!1},{name:"createdTime",label:"创建时间",width:150,show:!1}],r=n("68f2"),s=$api.admin.role,a={mixins:[r.b.dialog],data:function(){return{form:{title:"添加角色",icon:"add",width:"30%",action:s.add,model:{name:"",remarks:""},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]}},on:{success:this.onSuccess,open:this.onOpen}}},methods:{onSuccess:function(){this.$emit("success")},onOpen:function(){var e=this;this.$nextTick((function(){e.$refs.form.reset()}))}}},l=n("2877"),c=Object(l.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-form-dialog",e._g(e._b({ref:"form",attrs:{visible:e.visible_},on:{"update:visible":function(t){e.visible_=t}}},"nm-form-dialog",e.form,!1),e.on),[n("el-row",[n("el-col",{attrs:{span:20,offset:1}},[n("el-form-item",{attrs:{label:"名称：",prop:"name"}},[n("el-input",{model:{value:e.form.model.name,callback:function(t){e.$set(e.form.model,"name",t)},expression:"form.model.name"}})],1),n("el-form-item",{attrs:{label:"备注：",prop:"remarks"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.form.model.remarks,callback:function(t){e.$set(e.form.model,"remarks",t)},expression:"form.model.remarks"}})],1)],1)],1)],1)}),[],!1,null,null,null).exports,u=$api.admin.role,d={mixins:[r.b.formDialogEdit],data:function(){return{api:u,form:{title:"编辑角色",icon:"edit",width:"30%",action:u.update,model:{id:"",name:"",remarks:""},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},loading:!1}}}},h=Object(l.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-form-dialog",e._g(e._b({ref:"form",attrs:{visible:e.visible_},on:{"update:visible":function(t){e.visible_=t}}},"nm-form-dialog",e.form,!1),e.on),[n("el-row",[n("el-col",{attrs:{span:20,offset:1}},[n("el-form-item",{attrs:{label:"名称：",prop:"name"}},[n("el-input",{model:{value:e.form.model.name,callback:function(t){e.$set(e.form.model,"name",t)},expression:"form.model.name"}})],1),n("el-form-item",{attrs:{label:"备注：",prop:"remarks"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.form.model.remarks,callback:function(t){e.$set(e.form.model,"remarks",t)},expression:"form.model.remarks"}})],1)],1)],1)],1)}),[],!1,null,null,null).exports,m=n("a34a"),f=n.n(m),b={components:{MenuTree:n("cf13").a},mixins:[r.b.dialog],data:function(){return{split:.3,selection:null,buttons:[],checkAll:!1,isIndeterminate:!1,buttonChecked:[],tree:{showCheckbox:!0,defaultExpandAll:!0},treeOn:{check:this.onTreeCheck,change:this.onTreeChange,"check-change":this.onTreeCheckChange},disabledButton:!0}},props:{id:{type:String,required:!0},menuQueryAction:{type:Function,required:!0},menuUpdateAction:{type:Function,required:!0},buttonQueryAction:{type:Function,required:!0},buttonUpdateAction:{type:Function,required:!0}},computed:{hasButtons:function(){return this.selection&&this.buttons.length>0}},methods:{queryMenus:function(){var e=this;this.menuQueryAction().then((function(t){e.$refs.tree.setCheckedKeys(t),e.queryButtons()}))},queryButtons:function(){var e=this;this.buttons=[],this.buttonChecked=[],this.selection&&this.buttonQueryAction(this.selection.id).then((function(t){e.buttons=t,e.buttons.forEach((function(t){t.checked&&e.buttonChecked.push(t.id)})),e.onButtonCheckedChange(e.buttonChecked)}))},onTreeCheck:function(e,t){var n=[].concat(t.checkedKeys).concat(t.halfCheckedKeys);this.menuUpdateAction(n)},onTreeCheckChange:function(e,t){this.selection&&e.id===this.selection.id&&(this.selection.checked=t,this.disabledButton=!this.selection||!this.selection.checked)},onTreeChange:function(e,t){this.selection=Object.assign({},e.item),1===this.selection.type?(this.selection.checked=t.checked,this.disabledButton=!this.selection||!this.selection.checked,this.queryButtons()):this.buttons=[]},onButtonCheckAllChange:function(e){this.buttonChecked=e?this.buttons.map((function(e){return e.id})):[],this.isIndeterminate=!1,this.buttonUpdateAction({menuId:this.selection.id,checked:this.checkAll})},onButtonCheckedChange:function(e){var t=e.length;this.checkAll=t===this.buttons.length,this.isIndeterminate=t>0&&t<this.buttons.length},onButtonChange:function(e,t){this.buttonUpdateAction({menuId:this.selection.id,buttonId:e,checked:t})}},watch:{id:{immediate:!0,handler:function(e){e&&this.queryMenus()}}}},p=Object(l.a)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-split",{scopedSlots:e._u([{key:"left",fn:function(){return[n("menu-tree",e._g(e._b({ref:"tree"},"menu-tree",e.tree,!1),e.treeOn))]},proxy:!0},{key:"right",fn:function(){return[n("nm-box",{attrs:{page:"",header:"",title:"按钮设置",icon:"system"}},[e.hasButtons?[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate,disabled:e.disabledButton},on:{change:e.onButtonCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),n("el-divider"),n("el-checkbox-group",{attrs:{disabled:e.disabledButton},on:{change:e.onButtonCheckedChange},model:{value:e.buttonChecked,callback:function(t){e.buttonChecked=t},expression:"buttonChecked"}},e._l(e.buttons,(function(t){return n("el-checkbox",{key:t.id,attrs:{label:t.id,border:""},on:{change:function(n){return e.onButtonChange(t.id,n)}}},[e._v(e._s(t.name))])})),1)]:e._e()],2)]},proxy:!0}]),model:{value:e.split,callback:function(t){e.split=t},expression:"split"}})}),[],!1,null,null,null).exports;function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=$api.admin.role,y={components:{MenuBind:p},mixins:[r.b.dialog],data:function(){return{loading:!1}},props:{id:{type:String,required:!0}},methods:{menuQueryAction:function(){var e;return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],this.loading=!0,t.next=4,f.a.awrap(v.menuList(this.id));case 4:return t.sent.map((function(t){0!==t.menuType&&e.push(t.menuId)})),this.loading=!1,t.abrupt("return",e);case 8:case"end":return t.stop()}}),null,this)},menuUpdateAction:function(e){return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,f.a.awrap(v.bindMenu({id:this.id,menus:e}));case 3:this.loading=!1;case 4:case"end":return t.stop()}}),null,this)},buttonQueryAction:function(e){var t;return f.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return this.loading=!0,n.next=3,f.a.awrap(v.menuButtonList({id:this.id,menuId:e}));case 3:return t=n.sent,this.loading=!1,n.abrupt("return",t);case 6:case"end":return n.stop()}}),null,this)},buttonUpdateAction:function(e){this.loading=!0,v.bindMenuButton(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roleId:this.id},e)),this.loading=!1}}},x=Object(l.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-dialog",{attrs:{"no-scrollbar":"",width:"70%",height:"70%",title:"绑定菜单",icon:"bind",visible:e.visible_,loading:e.loading},on:{"update:visible":function(t){e.visible_=t}}},[n("menu-bind",{attrs:{id:e.id,"menu-query-action":e.menuQueryAction,"menu-update-action":e.menuUpdateAction,"button-query-action":e.buttonQueryAction,"button-update-action":e.buttonUpdateAction}})],1)}),[],!1,null,null,null).exports,C=$api.admin.role,_={name:i.default.name,components:{AddPage:c,EditPage:h,BindMenuPage:x},data:function(){return{list:{title:i.default.title,cols:o,action:C.query,model:{name:""}},addPage:{visible:!1},editDialog:{visible:!1,id:""},bindMenuDialog:{visible:!1,id:""},removeAction:C.remove,buttons:i.default.buttons}},methods:{refresh:function(){this.$refs.list.refresh()},edit:function(e){this.editDialog={id:e.id,visible:!0}},bindMenu:function(e){this.bindMenuDialog={id:e.id,visible:!0}}}},w=Object(l.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-container",[n("nm-list",e._b({ref:"list",scopedSlots:e._u([{key:"querybar",fn:function(){return[n("el-form-item",{attrs:{label:"名称：",prop:"name"}},[n("el-input",{attrs:{clearable:""},model:{value:e.list.model.name,callback:function(t){e.$set(e.list.model,"name",t)},expression:"list.model.name"}})],1)]},proxy:!0},{key:"querybar-buttons",fn:function(){return[n("nm-button",e._b({on:{click:function(t){e.addPage.visible=!0}}},"nm-button",e.buttons.add,!1))]},proxy:!0},{key:"col-name",fn:function(t){var i=t.row;return[i.isSpecified?n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"指定角色",placement:"top"}},[n("div",[n("nm-icon",{staticClass:"nm-text-warning",staticStyle:{"font-size":"25px"},attrs:{name:"star-fill"}}),n("span",[e._v(e._s(i.name))])],1)]):n("span",[e._v(e._s(i.name))])]}},{key:"col-operation",fn:function(t){var i=t.row;return[n("nm-button",e._b({attrs:{disabled:i.isSpecified},on:{click:function(t){return e.edit(i)}}},"nm-button",e.buttons.edit,!1)),n("nm-button",e._b({on:{click:function(t){return e.bindMenu(i)}}},"nm-button",e.buttons.bindMenu,!1)),n("nm-button-delete",e._b({attrs:{action:e.removeAction,id:i.id,disabled:i.isSpecified},on:{success:e.refresh}},"nm-button-delete",e.buttons.del,!1))]}}])},"nm-list",e.list,!1)),n("add-page",{attrs:{visible:e.addPage.visible},on:{"update:visible":function(t){return e.$set(e.addPage,"visible",t)},success:e.refresh}}),n("edit-page",{attrs:{id:e.editDialog.id,visible:e.editDialog.visible},on:{"update:visible":function(t){return e.$set(e.editDialog,"visible",t)},success:e.refresh}}),n("bind-menu-page",{attrs:{id:e.bindMenuDialog.id,visible:e.bindMenuDialog.visible},on:{"update:visible":function(t){return e.$set(e.bindMenuDialog,"visible",t)}}})],1)}),[],!1,null,null,null);t.default=w.exports},cf13:function(e,t,n){"use strict";var i=$api.admin.menu,o={data:function(){return{tree:{data:[],nodeKey:"id",highlightCurrent:!0,props:{children:"children",label:"label"},currentNodeKey:"00000000-0000-0000-0000-000000000000",expandOnClickNode:!1,defaultExpandedKeys:["00000000-0000-0000-0000-000000000000"]},on:{"current-change":this.onChange,"node-expand":this.onNodeExpand,"node-collapse":this.onNodeCollapse,"check-change":this.onCheckChange,check:this.onCheck},selection:null}},props:{refreshOnCreated:{type:Boolean,default:!0},showCheckbox:Boolean,defaultExpandAll:Boolean},methods:{refresh:function(e){var t=this;i.getTree().then((function(n){t.tree.data=[n],e?t.onChange(n):t.$nextTick((function(){t.$refs.tree.setCurrentKey(t.tree.currentNodeKey)}))}))},onChange:function(e,t){this.selection!==e&&(this.tree.currentNodeKey=e.id,this.selection=e,this.$emit("change",this.selection,t))},onCheck:function(e,t){this.$emit("check",e,t)},onCheckChange:function(e,t){this.$emit("check-change",e,t)},onNodeExpand:function(e){this.tree.defaultExpandedKeys.push(e.id)},onNodeCollapse:function(e){this.$_.pull(this.tree.defaultExpandedKeys,e.id)},insert:function(e){e.path=this.selection.path.concat([e.label]),e.children||(e.children=[]);var t=this.selection.children;if(t.length<1)t.push(e);else for(var n=0;n<t.length;n++){if(e.item.sort<t[n].item.sort){t.splice(n,0,e);break}if(n===t.length-1){t.push(e);break}}},remove:function(e){for(var t=this.selection.children,n=0;n<t.length;n++){var i=t[n];if(e===i.id)return t.splice(n,1),i}},update:function(e){var t=this.$refs.tree.getNode(e.id).expanded;t||this.$_.pull(this.tree.defaultExpandedKeys,e.id),e.children=this.remove(e.id).children,this.insert(e),t&&this.tree.defaultExpandedKeys.push(e.id)},setCheckedKeys:function(e){var t=this;this.$nextTick((function(){t.showCheckbox&&t.$refs.tree.setCheckedKeys(e)}))},sort:function(){this.refresh()}},created:function(){this.refreshOnCreated&&this.refresh(!0)}},r=n("2877"),s=Object(r.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nm-box",{attrs:{page:"",header:"",refresh:"",title:"菜单预览",icon:"menu"},on:{refresh:e.refresh}},[n("el-tree",e._g(e._b({ref:"tree",staticClass:"nm-tree",attrs:{"show-checkbox":e.showCheckbox,"default-expand-all":e.defaultExpandAll},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return n("span",{},[n("nm-icon",{attrs:{name:i.item.icon||"attachment"}}),n("span",{staticClass:"nm-m-l-5"},[e._v(e._s(i.label))])],1)}}])},"el-tree",e.tree,!1),e.on))],1)}),[],!1,null,null,null);t.a=s.exports}}]);